<!doctype html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@kentaroimai">
    <meta name="twitter:creator" content="@kentaroimai">
    
      <meta property="og:title" content="ノートアプリのおおまかな設計段階ですでに悩んでいる">
    
    
    <meta property="og:site_name" content="Kentaro Imai">
    <link rel="stylesheet" href="/css/style.css">
    <link href="/css/prism-gruvbox-dark.css" rel="stylesheet">
    <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Kentaro Imai">
    <title>ノートアプリのおおまかな設計段階ですでに悩んでいる | Kentaro Imai</title>
  </head>
  <body>
    <div class="container">
      <header class="header">
        
          <h2 class="header__site-title"><a class="header__link" href="/">Kentaro Imai</a></h2>
        
      </header>
      <main class="main">
        
          <h1 class="main__title"><a class="main__link" href="">ノートアプリのおおまかな設計段階ですでに悩んでいる</a></h1>
        
        
  <div class="post-meta">
    <time class="post-meta__date date" datetime="2023-04-21T15:45:00.000Z">Friday, 21 April 2023</time>
    <ul class="post-meta__tag-list tag-list"><li class="tag-list__tag tag"><a href="/tags/%E3%82%A2%E3%83%97%E3%83%AA%E9%96%8B%E7%99%BA/" class="tag__link">アプリ開発</a></li>
<li class="tag-list__tag tag"><a href="/tags/%E9%96%8B%E7%99%BA%E6%97%A5%E8%A8%98/" class="tag__link">開発日記</a></li>
<li class="tag-list__tag tag"><a href="/tags/OT/" class="tag__link">OT</a></li>
<li class="tag-list__tag tag"><a href="/tags/CRDT/" class="tag__link">CRDT</a></li>
<li class="tag-list__tag tag"><a href="/tags/Elixir/" class="tag__link">Elixir</a></li></ul>
  </div>

        <p>先月部屋を片付けた後、<code class="main__inline-code">Riverpod</code>をさらっと勉強したりしたが、取り立てて面白い話もない。</p>
<p>その後、サーバサイドの勉強をしていた。</p>
<p>作ろうとしているアプリはノートアプリなのでクライアントだけで完結するアプリにしても良いのだが、マルチデバイス対応をするつもりなのでやはりサーバベースで作りたい。この辺りは意見が分かれるところなのかもしれないが……。</p>
<p>もしかすると例えば<code class="main__inline-code">Realm</code>などを使って作るのが正解なのかもしれないが、<code class="main__inline-code">Realm</code>のことはよく分かっていないし、こういうコア部分をプロプライエタリなもので賄うのは怖い。</p>
<p>そういう訳で、サーバサイドを書かねばならない。</p>
<p>問題は、僕がサーバサイドのコードを書いていたのはもう10年以上前ってことで、さすがに勉強をしなおさないといけないだろう。</p>
<p>そこで、当時は<code class="main__inline-code">Ruby on Rails</code>をさわっていたが、もう随分前のことでもあるし、まっさらな気持ちでサーバサイドの技術を選ぶことにした。</p>
<p>とは言っても中々難しい。</p>
<ul>
<li>
<p>MVCやその亜種をベースにしたサーバサイドのフレームワークがいろんな言語で出ているが、その中から選ぶなら以前使っていた<code class="main__inline-code">Rails</code>を選ぶのが一番楽な気がする。</p>
</li>
<li>
<p>最近は<code class="main__inline-code">JavaScript</code>をちょっと書いていたので、そういう意味では<code class="main__inline-code">JavaScript</code>/<code class="main__inline-code">TypeScript</code>のサーバサイドフレームワークのいずれかを使うのも良いかもしれない。</p>
</li>
<li>
<p>一方で、実は僕には将来作りたいサービスがあって、それには<code class="main__inline-code">Elixir</code>と<code class="main__inline-code">Phoenix</code>がフィットする気がしていて、そこに繋げる意味では<code class="main__inline-code">Elixir</code>と<code class="main__inline-code">Phoenix</code>で作りたい。</p>
</li>
</ul>
<p>で、とりあえず、やって損はないだろうということで、<code class="main__inline-code">Elixir</code>の勉強をしていたのが最近の話だ。</p>
<p>ただ、今悩んでいることは、ノートの整合性保持で、ここの部分の設計をどうすべきなのか、決めきれないでいる。</p>
<p>例えばウェブアプリであれば、ユーザはおそらくオンラインだし、オフライン編集ができなくてもユーザは納得してくれるだろう。オンラインであれば、おひとり様用ウェブアプリの場合、編集後即サーバに<code class="main__inline-code">POST</code>/<code class="main__inline-code">PUT</code>/<code class="main__inline-code">PATCH</code>/<code class="main__inline-code">DELETE</code>すれば整合性の問題はほぼ起こらないだろう。</p>
<p>逆に、スマホアプリの場合、ユーザはオフラインでノート編集できることを期待する。ということは何らかのデータの競合解消ロジックが必要になる。</p>
<p>複数人で編集する場合はもちろん整合性の問題が起きるが、そうでなくても、ひとりが複数のデバイスから編集する場合、コンフリクトが起こる可能性は高い。</p>
<p>この整合性問題を解決するための技術が<code class="main__inline-code">OT</code>(Operational Transformation：操作変換)とか<code class="main__inline-code">CRDT</code>(Conflict-free Replicated Data Type)とか呼ばれるもので、この辺の知識が全く足りていない。</p>
<p>この辺の実装は<code class="main__inline-code">JavaScript</code>で書かれているものが多い気がするので、もしかするとサーバサイドはそういうライブラリを利用して<code class="main__inline-code">JavaScript</code>で書くべきなのかもしれない（折角<code class="main__inline-code">Elixir</code>の勉強をしていたところではあるが）。</p>
<p>ということで、サーバサイドを何で書くかということすら未だ確定できていないのである。</p>
<p>とりあえず、泥縄ではあるが、今から<code class="main__inline-code">OT</code>や<code class="main__inline-code">CRDT</code>の勉強をしようと思う。ただ、例えば<code class="main__inline-code">CRDT</code>と言ってもいろんなやり方が提案されているらしいので、それらの中から自分のアプリに合ったものを選ぶ必要がある。</p>
<p>もし詳しい人がいたら、何らか情報をもらえると嬉しいです。</p>
<p>あと、あんまり大変なようなら、とりあえずは個人使用を想定したノートアプリなのだから、競合解消ロジックなしで一旦リリースしてから考えるということも考えてはいる。</p>

      </main>
      <nav class="menu" id="main-menu">
        <button class="menu__toggle" id="menu__toggle">
          toggle menu
        </button>
        <div class="menu__dropdown" id="menu__dropdown">
          <ul class="site-nav">
            <li class="site-nav__item"><a class="site-nav__link" href="/archive/">Archive</a></li>
            <li class="site-nav__item"><a class="site-nav__link" href="/projects/">Projects</a></li>
            <li class="site-nav__item"><a class="site-nav__link" href="/feed/">Feed</a></li>
            <li class="site-nav__item"><a class="site-nav__link" href="/about/">About</a></li>
          </ul>
          <ul class="tag-cloud"><li class="tag-cloud__tag tag"><a href="/tags/CRDT/" class="tag__link" data-weight="4">CRDT</a></li>
<li class="tag-cloud__tag tag"><a href="/tags/Dart/" class="tag__link" data-weight="9">Dart</a></li>
<li class="tag-cloud__tag tag"><a href="/tags/Elixir/" class="tag__link" data-weight="4">Elixir</a></li>
<li class="tag-cloud__tag tag"><a href="/tags/Flutter/" class="tag__link" data-weight="9">Flutter</a></li>
<li class="tag-cloud__tag tag"><a href="/tags/OT/" class="tag__link" data-weight="4">OT</a></li>
<li class="tag-cloud__tag tag"><a href="/tags/%E3%82%A2%E3%83%97%E3%83%AA%E9%96%8B%E7%99%BA/" class="tag__link" data-weight="9">アプリ開発</a></li>
<li class="tag-cloud__tag tag"><a href="/tags/%E6%8A%80%E8%A1%93%E6%9B%B8/" class="tag__link" data-weight="9">技術書</a></li>
<li class="tag-cloud__tag tag"><a href="/tags/%E9%96%8B%E7%99%BA%E6%97%A5%E8%A8%98/" class="tag__link" data-weight="10">開発日記</a></li>
<li class="tag-cloud__tag tag"><a href="/tags/%E9%9B%91%E8%A8%98/" class="tag__link" data-weight="9">雑記</a></li></ul>
          
  <ul class="related-nav">
      
        <li class="related-nav__year"><time class="year" datetime="2023"><a class="year__link" href="/2023/">2023</a></time>
          <ul class="related-nav__months">
        <li class="related-nav__month"><time class="month" datetime="2023-05"><a class="month__link" href="/2023/05/">May</a></time>
          <ul class="related-nav__posts"><li class="related-nav__post"><a class="related-nav__link" href="/2023/05/誰のために書くのかがあやふやだったので決めた/">誰のために書くのかがあやふやだったので決めた</a></li></ul>
          </li><li class="related-nav__month"><time class="month" datetime="2023-04"><a class="month__link" href="/2023/04/">April</a></time>
          <ul class="related-nav__posts"><li class="related-nav__post"><a class="related-nav__link" href="/2023/04/ノートアプリのおおまかな設計段階ですでに悩んでいる/">ノートアプリのおおまかな設計段階ですでに悩んでいる</a></li><li class="related-nav__post"><a class="related-nav__link" href="/2023/04/部屋を片付けた話/">部屋を片付けた話</a></li></ul>
          </li><li class="related-nav__month"><time class="month" datetime="2023-03"><a class="month__link" href="/2023/03/">March</a></time>
          <ul class="related-nav__posts"><li class="related-nav__post"><a class="related-nav__link" href="/2023/03/DartとFlutterを学ぶための技術書について２/">DartとFlutterを学ぶための技術書について２</a></li><li class="related-nav__post"><a class="related-nav__link" href="/2023/03/DartとFlutterを学ぶための技術書について/">DartとFlutterを学ぶための技術書について</a></li></ul>
          </li><li class="related-nav__month"><time class="month" datetime="2023-02"><a class="month__link" href="/2023/02/">February</a></time>
          <ul class="related-nav__posts"><li class="related-nav__post"><a class="related-nav__link" href="/2023/02/新しいプロジェクト/">新しいプロジェクト</a></li></ul>
          </li></ul>
        </li>
      </ul>

        </div>
      </nav>
      <footer class="footer">
        <p class="footer__paragraph">
        Built with <a class="footer__link" href="https://www.11ty.dev/">Eleventy</a>. Theme colors are taken from <a class="footer__link" href="https://github.com/morhetz/gruvbox">gruvbox</a> by <a class="footer__link" href="https://github.com/morhetz">Pavel Pertsev</a>.
        </p>
        <p class="footer__paragraph">
          Copyright © 2011–2023 Kentaro Imai
        </p>
      </footer>
    </div>
    <script defer>
      var button = document.getElementById("menu__toggle");
      button.addEventListener("click", function(event) {
        event.preventDefault();
        var menu = document.getElementById("menu__dropdown");
        menu.classList.toggle("menu__dropdown--open");
      });
    </script>
  </body>
</html>
